---
- name: Install nginx
  apt:
    name: nginx
    state: present

- name: Allow for long server domainnames in nginx.conf (the autogenerated domainnames are long)
  shell: sed -i -e 's/# server_names_hash_bucket_size 64;/server_names_hash_bucket_size 128;/g' /etc/nginx/nginx.conf

- name: Include sites-enabled/default explicitly in nginx.conf, so it can be validated by nginx -t
  shell: sed -i -e 's/include /etc/nginx/sites-enabled/\*;/include /etc/nginx/sites-enabled/default;/g' /etc/nginx/nginx.conf

- name: Restart the Nginx service
  ansible.builtin.systemd:
    name: nginx.service
    state: restarted
    daemon_reload: true
